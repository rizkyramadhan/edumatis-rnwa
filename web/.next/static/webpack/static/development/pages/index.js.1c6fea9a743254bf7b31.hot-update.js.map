{"version":3,"file":"static/webpack/static/development/pages/index.js.1c6fea9a743254bf7b31.hot-update.js","sources":["webpack:///./pages/app/screens/siswa/Kewajiban/KewajibanDetail.tsx"],"sourcesContent":["import createRecord from \"@app/libs/queries/crud/createRecord\";\nimport { getSession } from \"@app/libs/queries/user/getsetSession\";\nimport UIContainer from \"@app/libs/ui/UIContainer\";\nimport UIHead from \"@app/libs/ui/UIHead\";\nimport UIWebView from \"@app/libs/ui/UIWebView\";\nimport { toJS } from \"mobx\";\nimport { observer, useObservable } from \"mobx-react-lite\";\nimport React, { useEffect } from \"react\";\nimport { ActivityIndicator, View, Text } from \"react-native\";\nimport updateRecord from \"@app/libs/queries/crud/updateRecord\";\nimport dayjs from \"dayjs\";\n\nexport default observer(({ navigation }: any) => {\n  const data = useObservable({\n    loading: true,\n    form: navigation.getParam(\"item\")\n  });\n  let transaksi: any = {};\n  if (data.form.transaksi.length > 0) {\n    transaksi = data.form.transaksi[0];\n  }\n  useEffect(() => {\n    const req = async function() {\n      const session = await getSession();\n      const nominalBeda =\n        data.form.status === \"Belum Lunas\" &&\n        transaksi &&\n        transaksi.detail.amount !== data.form.nominal;\n      const expired =\n        data.form.status === \"Belum Lunas\" &&\n        transaksi &&\n        dayjs(transaksi.detail.expiry_date).isBefore(dayjs());\n\n      if (!transaksi || nominalBeda || expired) {\n        if (!transaksi) {\n          let res = await createRecord(\"transaksi\", {\n            kewajiban_id: toJS(data.form.id)\n          });\n          data.form.transaksi.push({ id: res });\n          transaksi = data.form.transaksi[0];\n        }\n\n        if (nominalBeda) {\n          data.form.transaksi[0].detail = null;\n        }\n        var params: any = {\n          external_id: transaksi.id,\n          payer_email: session.murid.email || `j@edumatis.id`,\n          description: data.form.nama_kewajiban,\n          amount: data.form.nominal\n        };\n\n        var myHeaders = new Headers();\n        myHeaders.append(\"pragma\", \"no-cache\");\n        myHeaders.append(\"cache-control\", \"no-cache\");\n        const response: Response = await fetch(\n          `https://backend.cap.edumatis.id/invoice`,\n          {\n            method: \"POST\",\n            body: JSON.stringify(params),\n            headers: myHeaders\n          }\n        );\n        const json = await response.json();\n        await updateRecord(\"transaksi\", {\n          id: transaksi.id,\n          detail: json\n        });\n\n        data.form.transaksi[0].detail = json;\n      }\n      data.loading = false;\n    };\n    req();\n  }, []);\n\n  return (\n    <UIContainer style={{ backgroundColor: \"#F5FAFD\" }}>\n      <UIHead\n        title={`${data.form.nama_kewajiban} (${data.form.status})`}\n        onBack={() => {\n          navigation.goBack();\n        }}\n      />\n      <View\n        style={{\n          flex: 1,\n          padding: 10,\n          alignItems: \"center\",\n          justifyContent: \"center\"\n        }}\n      >\n        <ActivityIndicator\n          size=\"large\"\n          style={{ position: \"absolute\" }}\n          color=\"#999\"\n        />\n        <Text style={{ marginTop: 70 }}>\n          {!!transaksi.detail\n            ? \"Menampilkan Pembayaran...\"\n            : \"Membuat Invoice...\"}\n        </Text>\n        {transaksi.detail && (\n          <UIWebView\n            style={{\n              flex: 1,\n              position: \"absolute\",\n              width: \"100%\",\n              height: \"100%\",\n              zIndex: 99\n            }}\n            source={{\n              html: `<iframe width=\"100%\" height=\"100%\" src=\"${\n                transaksi.detail.invoice_url\n              }\"  frameborder=\"0\"></iframe>`\n            }}\n          />\n        )}\n      </View>\n    </UIContainer>\n  );\n});\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AAIA;AACA;AAPA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAcA;AADA;AACA;AAdA;AAaA;AAGA;AAAA;AAAA;AACA;AACA;AAlBA;AAoBA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AAhCA;AAAA;AAoCA;AACA;AACA;AAHA;AACA;AApCA;AAiCA;AAjCA;AAAA;AACA;AADA;AAyCA;AAzCA;AAAA;AA2CA;AACA;AAFA;AACA;AA3CA;AA+CA;AACA;AAhDA;AAiDA;AACA;AAlDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAkDA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AAJA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AAAA;AAAA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AADA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkBA;;;;A","sourceRoot":""}