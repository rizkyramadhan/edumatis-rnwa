{"version":3,"file":"static/webpack/static/development/pages/index.js.48c91f6eba55080ebfb9.hot-update.js","sources":["webpack:///./pages/app/screens/siswa/Kewajiban/KewajibanDetail.tsx"],"sourcesContent":["import createRecord from \"@app/libs/queries/crud/createRecord\";\nimport { getSession } from \"@app/libs/queries/user/getsetSession\";\nimport UIContainer from \"@app/libs/ui/UIContainer\";\nimport UIHead from \"@app/libs/ui/UIHead\";\nimport UIWebView from \"@app/libs/ui/UIWebView\";\nimport { toJS } from \"mobx\";\nimport { observer, useObservable } from \"mobx-react-lite\";\nimport React, { useEffect } from \"react\";\nimport { ActivityIndicator, View, Text, Alert } from \"react-native\";\nimport updateRecord from \"@app/libs/queries/crud/updateRecord\";\nimport dayjs from \"dayjs\";\n\nexport default observer(({ navigation }: any) => {\n  const data = useObservable({\n    error: \"\",\n    form: navigation.getParam(\"item\")\n  });\n  let transaksi: any = {};\n  if (data.form.transaksi.length > 0) {\n    transaksi = data.form.transaksi[0];\n  }\n  useEffect(() => {\n    const req = async function() {\n      const session = await getSession();\n      const nominalBeda =\n        data.form.status === \"Belum Lunas\" &&\n        transaksi &&\n        transaksi.detail &&\n        parseInt(transaksi.detail.amount) !== parseInt(data.form.nominal);\n\n      const expired =\n        data.form.status === \"Belum Lunas\" &&\n        transaksi &&\n        transaksi.detail &&\n        dayjs(transaksi.detail.expiry_date).isBefore(dayjs());\n      console.log(nominalBeda, expired, !transaksi, !transaksi.detail);\n\n      if (!transaksi || !transaksi.detail || nominalBeda || expired) {\n        if (!transaksi || !transaksi.detail) {\n          let res = await createRecord(\"transaksi\", {\n            kewajiban_id: toJS(data.form.id)\n          });\n          data.form.transaksi.push({ id: res });\n          transaksi = data.form.transaksi[0];\n          transaksi.id = res;\n        }\n\n        if (nominalBeda) {\n          data.form.transaksi[0].detail = null;\n        }\n        var params: any = {\n          external_id: transaksi.id,\n          payer_email: session.murid.email || `j@edumatis.id`,\n          description: data.form.nama_kewajiban,\n          amount: data.form.nominal\n        };\n\n        var myHeaders = new Headers();\n        myHeaders.append(\"pragma\", \"no-cache\");\n        myHeaders.append(\"cache-control\", \"no-cache\");\n        const response: Response = await fetch(\n          `https://backend.cap.edumatis.id/invoice`,\n          {\n            method: \"POST\",\n            body: JSON.stringify(params),\n            headers: myHeaders\n          }\n        );\n\n        if (response.status !== 200) {\n          const json = await response.json();\n          data.error = (json as any).message;\n          return;\n        }\n        const json = await response.json();\n        await updateRecord(\"transaksi\", {\n          id: transaksi.id,\n          detail: json\n        });\n\n        data.form.transaksi[0].detail = json;\n      }\n    };\n    req();\n  }, []);\n\n  return (\n    <UIContainer style={{ backgroundColor: \"#F5FAFD\" }}>\n      <UIHead\n        navigation={navigation}\n        title={`${data.form.nama_kewajiban} (${data.form.status})`}\n        onBack={() => {\n          navigation.goBack();\n        }}\n      />\n      <View\n        style={{\n          flex: 1,\n          alignItems: \"center\",\n          justifyContent: \"center\"\n        }}\n      >\n        {data.error === \"\" && !transaksi.detail && (\n          <Text>Membuat Invoice...</Text>\n        )}\n        {data.error != \"\" && <Text>{data.error}</Text>}\n        {data.error === \"\" && transaksi.detail && !transaksi.paid && (\n          <View\n            style={{\n              position: \"absolute\",\n              left: 0,\n              right: 0,\n              top: 0,\n              bottom: 0\n            }}\n          >\n            <UIWebView\n              style={{ flex: 1 }}\n              source={{\n                html: `\n            <!DOCTYPE html>\n            <html>\n                <head>\n                <meta name=\"viewport\" content=\" initial-scale=1\">\n                </head> \n                <body>\n                <center style=\"margin:100px\">Memuat<br/> Instruksi Pembayaran...</center>\n                <iframe \n                style=\"position:absolute;left:0;right:0;bottom:0;top:0;\"\n                width=\"100%\" height=\"100%\" src=\"${\n                  transaksi.detail.invoice_url\n                }\"  frameborder=\"0\"></iframe></div> \n            </body>\n            </html>`\n              }}\n            />\n          </View>\n        )}\n      </View>\n    </UIContainer>\n  );\n});\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AAMA;AAKA;AACA;AAdA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAkBA;AADA;AACA;AAlBA;AAiBA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AAvBA;AAyBA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AArCA;AAAA;AAyCA;AACA;AACA;AAHA;AACA;AAzCA;AAsCA;AACA;AAvCA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAgDA;AACA;AAjDA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAoDA;AApDA;AAAA;AAsDA;AACA;AAFA;AACA;AAtDA;AA0DA;AACA;AA3DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AA4DA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AACA;AACA;AACA;AAHA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AALA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AACA;AACA;AADA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyBA;;;;A","sourceRoot":""}