{"version":3,"file":"static/webpack/static/development/pages/index.js.0ff009159e6d095c8b5b.hot-update.js","sources":["webpack:///./pages/app/stores/Session.ts"],"sourcesContent":["import login from \"@app/libs/queries/user/login\";\nimport { flow, types } from \"mobx-state-tree\";\nimport AsyncStorage from \"@app/libs/utils/AsyncStorage\";\nimport { UserRecord } from \"./User\";\nimport List from \"@app/libs/utils/List\";\nimport Record from \"@app/libs/utils/Record\";\nimport config from \"@app/config\";\nimport rawQuery from \"@app/libs/queries/crud/rawQuery\";\n\nexport const SessionRecord = Record({\n  tableName: \"session\",\n  columns: {\n    id: types.maybe(types.string),\n    client_id: types.maybe(types.integer),\n    user: UserRecord\n  },\n  actions: (self: any) => ({\n    login: flow(function* (client_id, username, password) {\n      try {\n        const response = yield login(client_id, username, password);\n        yield AsyncStorage.setItem(\"SESSION\", JSON.stringify(response));\n        const result = yield rawQuery(`{\n          kelas_murid(where: {murid_id: {_eq: ${response.murid.id}}}) {\n            kelas {\n              sekolah {\n                nama_sekolah\n              }\n              nama_kelas\n              id\n            }\n          }\n        }`);\n        if (result) {\n          response.kelas = {\n            id: result.kelas_murid[0].kelas.id,\n            nama_kelas: result.kelas_murid[0].kelas.nama_kelas\n          }\n        }\n\n\n        console.log(result);\n        return response;\n      } catch (e) {\n        console.warn(e);\n        return false;\n      }\n    }),\n    restore: function (session: any) {\n      self.id = session.id;\n      self[config.table + \"_id\"] = session[config.table + \"_id\"];\n      self[config.table] = session[config.table];\n    },\n    logout: flow(function* () {\n      yield AsyncStorage.removeItem(\"SESSION\");\n      self.id = null;\n      self[config.table + \"_id\"] = null;\n      self[config.table] = null;\n    })\n  })\n});\n\nexport const SessionList = List({\n  record: SessionRecord,\n  query: `{\n    id\n    user_id\n  }`\n});\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAHA;AAEA;AAFA;AAGA;AACA;AAJA;AAAA;AAIA;AACA;AALA;AAIA;AACA;AAUA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAEA;AAvBA;AACA;AADA;AAAA;AAAA;AA0BA;AA1BA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8BA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAEA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AApCA;AAAA;AAPA;AAoDA;AACA;AACA;AAFA;;;;A","sourceRoot":""}